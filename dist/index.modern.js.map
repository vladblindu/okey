{"version":3,"file":"index.modern.js","sources":["../src/constants.js","../src/helpers.js","../src/index.js"],"sourcesContent":["export const TOKEN_KEY = 'token'\nexport const USER_KEY = 'user'\n","export const isEmpty = (o) => !Object.keys(o).length\n","import React from 'react'\nimport { TOKEN_KEY, USER_KEY } from './constants'\nimport { isEmpty } from './helpers'\n\n/**\n * @typedef {object} opts\n * @param {function} opts.httpAgent\n * @param {string?} opts.tokenKey\n * @param {function} opts.loginRedirect\n * @param {string?} opts.loginEndpoint\n * @param {string?} opts.registerEndpoint\n * @param {boolean} opts.registerEnabled\n * @param {string?} jwt  - if a valid localstorage session has been found\n * @param {object?} user - if a na authenticated call has been made - see above\n */\n\nexport const IS_AUTH = 1\nexport const LOGIN = 2\nexport const LOGOUT = 3\nexport const REGISTER = 4\nexport const USER = 5\n\nexport const AuthContext = React.createContext({})\n\nexport const AuthProvider = ({ config, children }) => {\n  const {\n    tokenKey = TOKEN_KEY,\n    userKey = USER_KEY,\n    loginRedirect,\n    loginEndpoint,\n    registerEnabled,\n    registerEndpoint,\n    httpAgent\n  } = config\n  const [user, setUser] = React.useState({})\n\n  const clearLocalStorage = () => {\n    localStorage.removeItem(tokenKey)\n    localStorage.removeItem(userKey)\n  }\n\n  const setToken = (jwt) => localStorage.setItem(tokenKey, jwt)\n  const setAuthData = (jwt, _user) => {\n    setToken(jwt)\n    setUser({ ...user, ..._user })\n  }\n\n  const login = async (identifier, password) => {\n    const authData = await httpAgent(loginEndpoint, {\n      identifier,\n      password\n    })\n    if (!authData.error) setAuthData(authData)\n    return authData\n  }\n\n  const register = async (registerData) => {\n    const regData = await httpAgent(registerEndpoint, registerData)\n    if (regData.error) return regData\n    if (!regData.error && registerEnabled && regData.jwt && regData.user)\n      setAuthData(regData)\n    return regData\n  }\n\n  const logout = () => {\n    setUser({})\n    clearLocalStorage()\n    loginRedirect()\n  }\n\n  const context = {\n    login,\n    logout,\n    register,\n    user,\n    isAuthenticated: () => isEmpty(user)\n  }\n\n  return <AuthContext.Provider value={context}>{children}</AuthContext.Provider>\n}\n\nexport const useAuth = (type) => {\n  const authContext = React.useContext(AuthContext)\n  if (type === IS_AUTH) return authContext.isAuthenticated()\n  if (type === LOGIN) return authContext.login\n  if (type === LOGOUT) return authContext.logout\n  if (type === REGISTER) return authContext.register\n  if (type === USER) return authContext.user\n}\n"],"names":["TOKEN_KEY","USER_KEY","isEmpty","o","Object","keys","length","IS_AUTH","LOGIN","LOGOUT","REGISTER","USER","AuthContext","React","createContext","AuthProvider","config","children","tokenKey","userKey","loginRedirect","loginEndpoint","registerEnabled","registerEndpoint","httpAgent","useState","user","setUser","clearLocalStorage","localStorage","removeItem","setToken","jwt","setItem","setAuthData","_user","login","identifier","password","authData","error","register","registerData","regData","logout","context","isAuthenticated","useAuth","type","authContext","useContext"],"mappings":"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"}