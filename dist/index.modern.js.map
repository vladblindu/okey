{"version":3,"file":"index.modern.js","sources":["../src/constants.js","../src/helpers.js","../src/index.js"],"sourcesContent":["export const TOKEN_KEY = 'token'\nexport const USER_KEY = 'user'\n","export const isEmpty = (o) => !Object.keys(o).length\n","import React from 'react'\nimport { HTTP, useHttp } from '@bitbrother/fetch-dog-hooks'\nimport { TOKEN_KEY, USER_KEY } from './constants'\nimport { isEmpty } from './helpers'\n\n/**\n * @typedef {object} opts\n * @param {function} opts.httpAgent\n * @param {string?} opts.tokenKey\n * @param {function} opts.loginRedirect\n * @param {string?} opts.loginEndpoint\n * @param {string?} opts.registerEndpoint\n * @param {boolean} opts.registerEnabled\n * @param {string?} jwt  - if a valid localstorage session has been found\n * @param {object?} user - if a na authenticated call has been made - see above\n */\n\nexport const AuthContext = React.createContext({})\n\nexport const AuthProvider = ({ config, children }) => {\n  const {\n    tokenKey = TOKEN_KEY,\n    userKey = USER_KEY,\n    loginRedirect,\n    loginEndpoint,\n    registerEnabled,\n    registerEndpoint\n  } = config\n\n  const [user, setUser] = React.useState({})\n  const httpAgent = useHttp(HTTP)\n\n  const clearLocalStorage = () => {\n    localStorage.removeItem(tokenKey)\n    localStorage.removeItem(userKey)\n  }\n\n  const setToken = (jwt) => localStorage.setItem(tokenKey, jwt)\n  const setAuthData = (payload) => {\n    setToken(payload.jwt)\n    setUser({ ...user, ...payload.user })\n    localStorage.setItem(userKey, JSON.stringify(payload.user))\n  }\n\n  const login = async (identifier, password) => {\n    const authData = await httpAgent(loginEndpoint, {\n      identifier,\n      password\n    })\n    if (!authData.error) setAuthData(authData)\n    return authData\n  }\n\n  const register = async (registerData) => {\n    const regData = await httpAgent(registerEndpoint, registerData)\n    if (regData.error) return regData\n    if (!regData.error && registerEnabled && regData.jwt && regData.user)\n      setAuthData(regData)\n    return regData\n  }\n\n  const logout = () => {\n    setUser({})\n    clearLocalStorage()\n    if (loginRedirect) loginRedirect()\n  }\n\n  const context = {\n    login,\n    logout,\n    register,\n    user,\n    isAuthenticated: !isEmpty(user)\n  }\n\n  return <AuthContext.Provider value={context}>{children}</AuthContext.Provider>\n}\n\nexport const useAuth = () => React.useContext(AuthContext)\nexport const useLogin = () => React.useContext(AuthContext).login\nexport const useLogout = () => React.useContext(AuthContext).logout\nexport const useRegister = () => React.useContext(AuthContext).register\nexport const useIsAuth = () => React.useContext(AuthContext).isAuthenticated\nexport const useUser = () => React.useContext(AuthContext).user\n"],"names":["TOKEN_KEY","USER_KEY","isEmpty","o","Object","keys","length","AuthContext","React","createContext","AuthProvider","config","children","tokenKey","userKey","loginRedirect","loginEndpoint","registerEnabled","registerEndpoint","user","setUser","useState","httpAgent","useHttp","HTTP","clearLocalStorage","localStorage","removeItem","setToken","jwt","setItem","setAuthData","payload","JSON","stringify","login","identifier","password","authData","error","register","registerData","regData","logout","context","isAuthenticated","useAuth","useContext","useLogin","useLogout","useRegister","useIsAuth","useUser"],"mappings":"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"}