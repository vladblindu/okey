{"version":3,"file":"index.js","sources":["../src/constants.js","../src/helpers.js","../src/index.js"],"sourcesContent":["export const TOKEN_KEY = 'token'\nexport const USER_KEY = 'user'\n","export const isEmpty = (o) => !Object.keys(o).length\n","import React from 'react'\nimport { TOKEN_KEY, USER_KEY } from './constants'\nimport { isEmpty } from './helpers'\n\n/**\n * @typedef {object} opts\n * @param {function} opts.httpAgent\n * @param {string?} opts.tokenKey\n * @param {function} opts.loginRedirect\n * @param {string?} opts.loginEndpoint\n * @param {string?} opts.registerEndpoint\n * @param {boolean} opts.registerEnabled\n * @param {string?} jwt  - if a valid localstorage session has been found\n * @param {object?} user - if a na authenticated call has been made - see above\n */\n\nexport const AuthContext = React.createContext({})\n\nexport const AuthProvider = ({ config, children }) => {\n  const {\n    tokenKey = TOKEN_KEY,\n    userKey = USER_KEY,\n    loginRedirect,\n    loginEndpoint,\n    registerEnabled,\n    registerEndpoint,\n    httpAgent\n  } = config\n\n  const [user, setUser] = React.useState({})\n\n  const clearLocalStorage = () => {\n    localStorage.removeItem(tokenKey)\n    localStorage.removeItem(userKey)\n  }\n\n  const setToken = (jwt) => localStorage.setItem(tokenKey, jwt)\n  const setAuthData = (payload) => {\n    setToken(payload.jwt)\n    setUser({ ...user, ...payload.user })\n    localStorage.setItem(userKey, JSON.stringify(payload.user))\n  }\n\n  const login = async (identifier, password) => {\n    const authData = await httpAgent(loginEndpoint, {\n      identifier,\n      password\n    })\n    console.log(authData)\n    if (!authData.error) setAuthData(authData)\n    return authData\n  }\n\n  const register = async (registerData) => {\n    console.log(config)\n    const regData = await httpAgent(registerEndpoint, registerData)\n    if (regData.error) return regData\n    if (!regData.error && registerEnabled && regData.jwt && regData.user)\n      setAuthData(regData)\n    return regData\n  }\n\n  const logout = () => {\n    setUser({})\n    clearLocalStorage()\n    if (loginRedirect) loginRedirect()\n  }\n\n  const context = {\n    login,\n    logout,\n    register,\n    user,\n    isAuthenticated: !isEmpty(user)\n  }\n\n  return <AuthContext.Provider value={context}>{children}</AuthContext.Provider>\n}\n\nexport const useAuth = () => React.useContext(AuthContext)\nexport const useLogin = () => React.useContext(AuthContext).login\nexport const useLogout = () => React.useContext(AuthContext).logout\nexport const useRegister = () => React.useContext(AuthContext).register\nexport const useIsAuth = () => React.useContext(AuthContext).isAuthenticated\nexport const useUser = () => React.useContext(AuthContext).user\n"],"names":["TOKEN_KEY","USER_KEY","isEmpty","o","Object","keys","length","AuthContext","React","createContext","AuthProvider","config","children","tokenKey","userKey","loginRedirect","loginEndpoint","registerEnabled","registerEndpoint","httpAgent","useState","user","setUser","clearLocalStorage","localStorage","removeItem","setToken","jwt","setItem","setAuthData","payload","JSON","stringify","login","identifier","password","authData","console","log","error","register","registerData","regData","logout","context","isAuthenticated","useAuth","useContext","useLogin","useLogout","useRegister","useIsAuth","useUser"],"mappings":"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"}