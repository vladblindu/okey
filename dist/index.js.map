{"version":3,"file":"index.js","sources":["../src/constants.js","../src/helpers.js","../src/index.js"],"sourcesContent":["export const TOKEN_KEY = 'token'\nexport const USER_KEY = 'user'\n","export const isEmpty = (o) => !Object.keys(o).length\n","import React from 'react'\nimport { HTTP, useHttp } from '@bitbrother/fetch-dog-hooks'\nimport { TOKEN_KEY, USER_KEY } from './constants'\nimport { isEmpty } from './helpers'\n\n/**\n * @typedef {object} opts\n * @param {function} opts.httpAgent\n * @param {string?} opts.tokenKey\n * @param {function} opts.loginRedirect\n * @param {string?} opts.loginEndpoint\n * @param {string?} opts.registerEndpoint\n * @param {boolean} opts.registerEnabled\n * @param {string?} jwt  - if a valid localstorage session has been found\n * @param {object?} user - if a na authenticated call has been made - see above\n */\n\nexport const AuthContext = React.createContext({})\n\nexport const AuthProvider = ({ config, children }) => {\n  const {\n    tokenKey = TOKEN_KEY,\n    userKey = USER_KEY,\n    loginRedirect,\n    loginEndpoint,\n    registerEnabled,\n    registerEndpoint\n  } = config\n\n  const [user, setUser] = React.useState({})\n  const httpAgent = useHttp(HTTP)\n\n  const clearLocalStorage = () => {\n    localStorage.removeItem(tokenKey)\n    localStorage.removeItem(userKey)\n  }\n\n  const setToken = (jwt) => localStorage.setItem(tokenKey, jwt)\n  const setAuthData = (payload) => {\n    setToken(payload.jwt)\n    setUser({ ...user, ...payload.user })\n    localStorage.setItem(userKey, JSON.stringify(payload.user))\n  }\n\n  const login = async (identifier, password) => {\n    const authData = await httpAgent(loginEndpoint, {\n      identifier,\n      password\n    })\n    if (!authData.error) setAuthData(authData)\n    return authData\n  }\n\n  const register = async (registerData) => {\n    const regData = await httpAgent(registerEndpoint, registerData)\n    if (regData.error) return regData\n    if (!regData.error && registerEnabled && regData.jwt && regData.user)\n      setAuthData(regData)\n    return regData\n  }\n\n  const logout = () => {\n    setUser({})\n    clearLocalStorage()\n    if (loginRedirect) loginRedirect()\n  }\n\n  const context = {\n    login,\n    logout,\n    register,\n    user,\n    isAuthenticated: !isEmpty(user)\n  }\n\n  return <AuthContext.Provider value={context}>{children}</AuthContext.Provider>\n}\n\nexport const useAuth = () => React.useContext(AuthContext)\nexport const useLogin = () => React.useContext(AuthContext).login\nexport const useLogout = () => React.useContext(AuthContext).logout\nexport const useRegister = () => React.useContext(AuthContext).register\nexport const useIsAuth = () => React.useContext(AuthContext).isAuthenticated\nexport const useUser = () => React.useContext(AuthContext).user\n"],"names":["TOKEN_KEY","USER_KEY","isEmpty","o","Object","keys","length","AuthContext","React","createContext","AuthProvider","config","children","tokenKey","userKey","loginRedirect","loginEndpoint","registerEnabled","registerEndpoint","useState","user","setUser","httpAgent","useHttp","HTTP","clearLocalStorage","localStorage","removeItem","setToken","jwt","setItem","setAuthData","payload","JSON","stringify","login","identifier","password","authData","error","register","registerData","regData","logout","context","isAuthenticated","useAuth","useContext","useLogin","useLogout","useRegister","useIsAuth","useUser"],"mappings":"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"}